# Maintainer:  <voobscout@archlinux.info>

# Inspired by cawilliamson https://github.com/cawilliamson/ansible-gpdpocket

pkgname=gpd-fan
pkgver=0.1.0
pkgrel=1
arch=('x86_64')
url="https://github.com/njkli/gpd-pocket/tree/master/gpd-fan"
license=('MIT')
provides=('gpd-fan')
depends=('i2c-tools' 'thermald' 'tlp' 'gc' 'libatomic_ops' 'pcre' 'libevent' 'llvm-libs')
makedepends=('crystal' 'shards')
install=gpd-fan.install
source=('gpd-fan.cr'
        'gpd-fan.example'
        'gpd-fan.service'
        'gpd-fan.sleep'
        'shard.yml'
       )
sha256sums=('3ec694bee0f6123922e3935dd6a82321a6c935ed2c656e47bf99d32a653fa5f0'
            'cfbf435913ce877ecba888b4681ec822a85e3dfbb7fc04c1e60932feed751ce8'
            'b3196d907b3dedf566fd54aee60fae021b20f11519c5487293d8ac8cb6256113'
            'dd30ca69076fd7548449f33e701fe09df889595443e93a04f23a3e581444a914'
            '84493819929edd6851d383720a81755ffc1ec1dc407bbaf063e21bd88f95d7f8')

prepare() {
  find ./ -type l -delete
  for i in ${source[@]}; do cp ../$i ./; done
}

pkgver() {
  printf "v%s" "$(grep define_version $srcdir/gpd-fan.cr | awk '{print $2}' | sed 's/\"//g')"
}

build() {
  crystal deps
  msg 'Building binary...'
  crystal build gpd-fan.cr
}

package() {
  mkdir -p $pkgdir/usr/bin
  mkdir -p $pkgdir/usr/lib/systemd/system
  mkdir -p $pkgdir/etc/default
  mkdir -p $pkgdir/usr/lib/systemd/system-sleep

  install -Dm0755 "$srcdir/gpd-fan" "$pkgdir/usr/bin/gpd-fan"
  install -Dm0644 "$srcdir/gpd-fan.service" "$pkgdir/usr/lib/systemd/system/gpd-fan.service"
  install -Dm0644 "$srcdir/gpd-fan.example" "$pkgdir/etc/default/gpd-fan.example"
  install -Dm0755 "$srcdir/gpd-fan.sleep" "$pkgdir/usr/lib/systemd/system-sleep/gpd-fan"
}

# vim:set ts=2 sw=2 et:
